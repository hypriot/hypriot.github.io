<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> How to use Docker Swarm 0.2.0 on your Raspberry Pi cluster &middot; Docker Pirates ARMed with explosive stuff </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/hypriot.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Docker Pirates ARMed with explosive stuff" />
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-59194692-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-logo">
      <a href="/"><img src="/images/logo_tr.png" /></a>
    </div>
    <div class="sidebar-about">
      <h1><a href="/">Docker Pirates ARMed with explosive stuff</a></h1>
      <p class="lead">
       Roaming the seven seas in search for golden container plunder. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">HOME</a> </li>
      
        <li><a href="/crew/"> CREW </a></li>
      
        <li><a href="/downloads/"> DOWNLOADS </a></li>
      
    </ul>

    <p>&copy; 2015 Hypriot - all rights reserved. </p>
    <p><a href="/legal_notice" style="font-size: 1rem;">Legal Notice</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>How to use Docker Swarm 0.2.0 on your Raspberry Pi cluster</h1>
    <span class="post-date">Sun, Apr 19, 2015</span>
    

<p>Some days ago Docker Swarm 0.2.0 was released. In this blog post we show you how easy it is to install Swarm on your Raspberry Pi cluster and how to setup a Raspberry Pi Swarm cluster.</p>

<p>We&rsquo;ve built a little &ldquo;Pi Tower&rdquo; with three Raspberry Pi 2 model B and combine them into a Docker Swarm.</p>

<p>As you can see in the pictures below we&rsquo;ve mounted the three Raspberry Pi&rsquo;s on top of a 5-port D-Link GBit switch. All four devices get their power from an Anker 4-port USB charger. This makes a very solid but portable &ldquo;Pi Tower&rdquo; with only one power plug and one external network connector.</p>

<p><div class="gallery clearfix" itemscope itemtype="http://schema.org/ImageGallery">
<div class="title">Pi Tower</div>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/docker-swarm/d-link_mounting_holes.jpg" itemprop="contentUrl" data-size="1600x1200">
      <img src="/images/docker-swarm/thumbnails/thumb_d-link_mounting_holes.jpg" itemprop="thumbnail" alt="The Making of Pi Tower" />
  </a>


  <figcaption itemprop="caption description">
    The Making of Pi Tower
    <span itemprop="copyrightHolder">Hypriot</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/docker-swarm/d-link_rpi2_cluster.jpg" itemprop="contentUrl" data-size="1600x1200">
      <img src="/images/docker-swarm/thumbnails/thumb_d-link_rpi2_cluster.jpg" itemprop="thumbnail" alt="Pi Tower with D-Link Switch" />
  </a>


  <figcaption itemprop="caption description">
    Pi Tower with D-Link Switch
    <span itemprop="copyrightHolder">Hypriot</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/docker-swarm/d-link_rpi2_cluster02.jpg" itemprop="contentUrl" data-size="1600x1200">
      <img src="/images/docker-swarm/thumbnails/thumb_d-link_rpi2_cluster02.jpg" itemprop="thumbnail" alt="Pi Tower with D-Link Switch" />
  </a>


  <figcaption itemprop="caption description">
    Pi Tower with D-Link Switch
    <span itemprop="copyrightHolder">Hypriot</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/docker-swarm/d-link_rpi2_cluster_lights.jpg" itemprop="contentUrl" data-size="1600x1200">
      <img src="/images/docker-swarm/thumbnails/thumb_d-link_rpi2_cluster_lights.jpg" itemprop="thumbnail" alt="Pi Tower at night" />
  </a>


  <figcaption itemprop="caption description">
    Pi Tower at night
    <span itemprop="copyrightHolder">Hypriot</span>
  </figcaption>
</figure>


</div>
</p>

<p><link rel="stylesheet" href="/css/photoswipe.css">
<link rel="stylesheet" href="/css/default-skin/default-skin.css">
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>
<script src="/js/initphotoswipe.js"></script>



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


<style>
    .gallery {  }
    .gallery img { width: 100%; height: auto; }
    .gallery figure { display: block; float: left; margin: 0 5px 5px 0; width: 200px; }
    .gallery figcaption { display: none; }
    .gallery div.title { font-weight: bold; }
    span[itemprop="copyrightHolder"] { color : #888; float: right; }
    span[itemprop="copyrightHolder"]:before { content: "Foto: "; }
    img[itemprop="thumbnail"]{ width: 200px; }
</style>


<script>initPhotoSwipeFromDOM('.gallery');</script>
</p>

<h2 id="pre-requisites-for-running-swarm-on-the-raspberry-pi:92a945dc404f30244b27200a8a0eae98">Pre-requisites for running Swarm on the Raspberry Pi</h2>

<p>First we want to use the latest and greatest Hypriot SD card image with Docker 1.6.0 preinstalled. On a Mac or Linux machine, we use our little <a href="https://github.com/hypriot/flash">flash command line tool</a> to prepare the three SD cards with these simple commands.</p>

<pre><code class="language-bash">$ flash --hostname pi1 http://assets.hypriot.com/hypriot-rpi-20150416-201537.img.zip
$ flash --hostname pi2 /tmp/hypriot-rpi-20150416-201537.img
$ flash --hostname pi3 /tmp/hypriot-rpi-20150416-201537.img
</code></pre>

<p>Now insert the SD cards into all Raspberry Pi&rsquo;s and boot them. They will come up with different host names after a while.</p>

<h2 id="install-swarm:92a945dc404f30244b27200a8a0eae98">Install Swarm</h2>

<p>Login <strong>to each</strong> of your Raspberry Pi&rsquo;s and pull our small  <a href="https://registry.hub.docker.com/u/hypriot/rpi-swarm/">hypriot/rpi-swarm</a> Docker image containing the Docker Swarm 0.2.0 binary. Afterwards we tag the Docker image so we can just follow the <a href="https://docs.docker.com/swarm/">official Docker Swarm documentation</a>.</p>

<pre><code class="language-bash">$ docker pull hypriot/rpi-swarm
$ docker tag hypriot/rpi-swarm swarm
</code></pre>

<h2 id="set-up-swarm-nodes:92a945dc404f30244b27200a8a0eae98">Set up Swarm nodes</h2>

<p>On the first Raspberry Pi create the Swarm Cluster ID. The output is the ID and will be used later on.</p>

<pre><code class="language-bash">$ docker run --rm swarm create
&lt;cluster_id&gt;
</code></pre>

<h3 id="open-the-docker-tcp-port:92a945dc404f30244b27200a8a0eae98">Open the Docker TCP Port</h3>

<p><strong>On each</strong> of your Raspberry Pi&rsquo;s you have to open the Docker port. For this blog post we just use the TCP port without TLS.</p>

<pre><code class="language-bash">$ sudo vi /etc/default/docker
</code></pre>

<p>Edit the line with the <code>DOCKER_OPTS</code> and append the two <code>-H</code> options.</p>

<pre><code>DOCKER_OPTS=&quot;--storage-driver=overlay -D -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock&quot;
</code></pre>

<p>Now restart the Docker daemon on each Raspberry Pi.</p>

<pre><code class="language-bash">$ sudo service docker restart
</code></pre>

<h3 id="register-the-swarm-agents:92a945dc404f30244b27200a8a0eae98">Register the Swarm agents</h3>

<p><strong>On each</strong> Raspberry Pi start the Swarm agent. With this convenient command you can repeat the same command on all of your Pi&rsquo;s. It will retrieve the IP address of each Pi automatically.</p>

<pre><code class="language-bash">$ docker run -d swarm join --addr=`hostname -I | cut -f 1 -d ' '`:2375 token://&lt;cluster_id&gt;
</code></pre>

<h3 id="start-swarm-manager:92a945dc404f30244b27200a8a0eae98">Start Swarm manager</h3>

<p>On the first Raspberry Pi we also start the Swarm manager. This has to use a different port, so we use 3375 for this example.</p>

<pre><code class="language-bash">$ docker run -d -p 3375:2375 swarm manage token://&lt;cluster_id&gt;
</code></pre>

<p>Now we can check if everything worked well.</p>

<pre><code class="language-bash">$ docker -H tcp://localhost:3375 info
Containers: 17
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 3
 pi1: 192.168.33.68:2375
  └ Containers: 4
  └ Reserved CPUs: 0 / 4
  └ Reserved Memory: 0 B / 971.3 MiB
 pi2: 192.168.33.203:2375
  └ Containers: 11
  └ Reserved CPUs: 0 / 4
  └ Reserved Memory: 0 B / 971.3 MiB
 pi3: 192.168.33.201:2375
  └ Containers: 2
  └ Reserved CPUs: 0 / 4
  └ Reserved Memory: 0 B / 971.3 MiB
</code></pre>

<p>After setting up the Docker Swarm you now can use the normal Docker commands through the port 3375. Have a look at the <a href="https://docs.docker.com/swarm/">official Docker Swarm documentation</a> for more details.</p>

<p>We hope you enjoyed this little tour of Docker Swarm!</p>

<p>As always use the comments below to give us feedback and share it on Twitter or Facebook.</p>

    <div class="social-sharing">
  
<div class="social-sharing-twitter" style="float: left;">
  <a class="twitter-share-button"
    href="https://twitter.com/share"
    data-url="http://blog.hypriot.com/post/docker-swarm-0-2-0-on-raspberry-pi/"
    data-lang="en"
    data-via="HypriotTweets">
  Tweet
  </a>
  <script>
  window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
  </script>
</div>

  
<div class="social-sharing-facebook">
  <div id="fb-root"></div>
  <div class="social-sharing-facebook">
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/de_DE/sdk.js#xfbml=1&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
  <div class="fb-share-button" data-href="http://blog.hypriot.com/post/docker-swarm-0-2-0-on-raspberry-pi/" data-layout="button_count"></div>
</div>

</div>

    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'hypriot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</div>

<script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
